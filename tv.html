<!-- tv.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Axxess Live Sales — TV</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#ffffff;--card:#f6f9fc;--accent:#00a6c2;--text:#0b2b3a;--muted:#6b7c86}
  body{margin:0;background:linear-gradient(180deg,#fff 0,#f2f7fb 100%);font-family:Inter,system-ui;color:var(--text)}
  .wrap{max-width:1200px;margin:36px auto;padding:18px}
  .logo{display:flex;align-items:center;gap:12px}
  .logo img{width:72px;height:72px;border-radius:10px}
  h1{text-align:center;margin:8px 0}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:18px;margin-top:24px}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(14,30,37,0.06)}
  .name{font-weight:700;color:var(--accent)}
  .muted{color:var(--muted)}
  .bar{margin-top:12px;height:12px;background:#e6edf2;border-radius:8px;overflow:hidden}
  .fill{height:100%;background:linear-gradient(90deg,#00c6d4,#00a6c2)}
</style>
</head>
<body>
<div class="wrap">
  <div class="logo"><img src="https://i.ibb.co/1GrhnMc4/images.jpg" alt="logo"><div style="text-align:center;width:100%"><h1>Axxess Live Sales</h1><div style="color:var(--muted);">Auto-updating team progress</div></div></div>

  <div class="cards" id="cards"></div>
</div>

<script type="module">
import { supabase } from './supabase-config.js';

async function loadCards(){
  const { data: agents } = await supabase.from('agents').select('id,name,target,sales,team_id');
  const grid = document.getElementById('cards');
  grid.innerHTML = (agents||[]).map(a => {
    const pct = a.target > 0 ? Math.min(100, (Number(a.sales||0)/Number(a.target))*100) : 0;
    return `<div class="card">
      <div class="name">${a.name}</div>
      <div class="muted">Team: ${a.team_id || '—'}</div>
      <div style="margin-top:10px">Target: R${Number(a.target||0).toLocaleString()} • Sales: R${Number(a.sales||0).toLocaleString()}</div>
      <div class="bar"><div class="fill" style="width:${pct}%"></div></div>
      <div style="text-align:center;margin-top:8px">${pct.toFixed(1)}% achieved</div>
    </div>`;
  }).join('');
}

loadCards();

supabase.channel('tv-updates')
  .on('postgres_changes', { event:'INSERT', schema:'public', table:'sales_log' }, ()=> loadCards())
  .on('postgres_changes', { event:'UPDATE', schema:'public', table:'agents' }, ()=> loadCards())
  .subscribe();
</script>
</body>
</html>
